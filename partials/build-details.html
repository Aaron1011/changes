<section>
	<div id="overview">
		<div class="page-header build-header status-{{build.status.id}} result-{{build.result.id}}">
			<div class="indicator" title="{{build.result.name}}">
				<div data-result="{{build.result.id}}"
					 data-status="{{build.status.id}}"
					 data-date-started="{{build.dateStarted}}"
					 data-estimated-duration="{{build.estimatedDuration}}"
					 radial-progress-bar>&nbsp;</div>
			</div>
			<h2>{{build.name}} <small>({{build.parent_revision.sha}})</small></h2>
		</div>

		<dl class="flat">
			<dt ng-if="build.author">Author:</dt>
			<dd ng-if="build.author">{{build.author.name}} <span ng-if="build.author.email">(<a href="mailto:{{build.author.email}}">{{build.author.email}}</a>)</span></dd>
			<dt>Project:</dt>
			<dd><a href="#">{{build.project.name}}</a></dd>
			<dt ng-if="build.change">Change:</dt>
			<dd ng-if="build.change"><a href="#">{{build.change.name}}</a></dd>
			<dt>Revision:</dt>
			<dd>{{build.parent_revision.sha}}</dd>
			<dt>Status:</dt>
			<dd>{{build.status.name}} <span ng-if="build.status.id == 'finished'">({{build.result.name}})</span></dd>
			<dt ng-if="build.dateStarted">Started:</dt>
			<dd ng-if="build.dateStarted" time-since="build.dateStarted"></dd>
			<dt ng-if="build.duration">Duration:</dt>
			<dd ng-if="build.duration" duration="build.duration"></dd>
			<dt ng-if="build.external">External:</dt>
			<dd ng-if="build.external"><a href="{{ build.external.link }}">{{ build.external.label }}</a></dd>
		</dl>

		<pre ng-if="build.message" class="build-message" ng-bind-html="build.message | escape | linkify"></pre>

		<ul class="nav nav-justified nav-tabs phase-list" ng-if="phases">
			<li ng-repeat="phase in phases | orderBy:'dateStarted'" class="result-{{phase.result.id}}">
				<a href="#">{{phase.name}}</a>
			</li>
		</ul>

	</div>

	<div id="test-results">
		<div class="page-header">
			<h3>Test Results</h3>
		</div>

		<div ng-if="build.status.id != 'finished'">
			<div class="progress progress-striped active">
				<div class="progress-bar" role="progressbar" style="width:100%">
					<span class="sr-only">Waiting on test results...</span>
			 	</div>
			</div>
		</div>

		<div ng-switch="getTestStatus()">
			<div ng-switch-when="no-results">
				<p>No test results were recorded.</p>
			</div>
			<div ng-switch-default>
				<ul class="pagination pagination-sm" ng-if="testsPaginator.numPages > 1">
					<li ng-class="{'disabled': testsPaginator.page == 0}">
						<a href="javascript:void(0)" ng-click="testsPaginator.prevPage()">&laquo;</a>
					</li>
					<li ng-repeat="n in testsPaginator.getPageRange()" ng-class="{'active': n == testsPaginator.page}">
						<a href="javascript:void(0)" ng-click="testsPaginator.jumpToPage(n)">{{n + 1}}</a>
					</li>
					<li ng-class="{'disabled': testsPaginator.page == testsPaginator.numPages - 1}">
						<a href="javascript:void(0)" ng-click="testsPaginator.nextPage()">&raquo;</a>
					</li>
				</ul>
				<table class="test-results table table-striped">
					<tbody>
						<tr ng-repeat="test in tests | startFrom: testsPaginator.offset | limitTo: testsPaginator.perPage" class="status-{{test.result.id}}">
							<td><a href="{{test.link}}">{{ test.name }}</a><br><small>{{ test.package }}</small></td>
							<td duration="test.duration"></td>
							<td><a href="{{test.link}}"><span class="glyphicon glyphicon-zoom-in"></span></a></td>
						</tr>
					</tbody>
				</table>
				<ul class="pagination pagination-sm" ng-if="testsPaginator.numPages > 1">
					<li ng-class="{'disabled': testsPaginator.page == 0}">
						<a href="javascript:void(0)" ng-click="testsPaginator.prevPage()">&laquo;</a>
					</li>
					<li ng-repeat="n in testsPaginator.getPageRange()" ng-class="{'active': n == testsPaginator.page}">
						<a href="javascript:void(0)" ng-click="testsPaginator.jumpToPage(n)">{{n + 1}}</a>
					</li>
					<li ng-class="{'disabled': testsPaginator.page == testsPaginator.numPages - 1}">
						<a href="javascript:void(0)" ng-click="testsPaginator.nextPage()">&raquo;</a>
					</li>
				</ul>
			</div>
		</div>
	</div>
</section>
