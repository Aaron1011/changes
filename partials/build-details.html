<section>
	<div id="overview">
		<div class="page-header build-header status-{{build.status.id}} result-{{build.result.id}}">
			<div class="indicator" title="{{build.result.name}}">
				<div data-result="{{build.result.id}}"
					 data-status="{{build.status.id}}"
					 data-date-started="{{build.dateStarted}}"
					 data-estimated-duration="{{build.estimatedDuration}}"
					 radial-progress-bar>&nbsp;</div>
			</div>
			<h2>
				{{build.name}}<br>
				<small>
					<span ng-if="build.number">#{{build.number}} &mdash; </span>
					{{build.target}}
					<span ng-if="build.author"> &mdash; {{build.author.name}}</span>
				</small>
			</h2>
		</div>

		<barchart ng-model="chartData" style="height:130px"></barchart>

		<div class="row">
			<div class="col-lg-9 col-md-8">
				<dl class="flat">
					<dt ng-if="build.author">Author:</dt>
					<dd ng-if="build.author">{{build.author.name}} <span ng-if="build.author.email">(<a href="mailto:{{build.author.email}}">{{build.author.email}}</a>)</span></dd>
					<dt>Project:</dt>
					<dd><a href="{{build.project.link}}">{{build.project.name}}</a></dd>
					<dt ng-if="build.source.revision">Revision:</dt>
					<dd ng-if="build.source.revision">
						<a href="/projects/{{project.id}}/commits/{{build.source.revision.sha}}/">{{build.source.revision.sha}}</a>
					</dd>
					<dt ng-if="build.source.patch">Patch:</dt>
					<dd ng-if="build.source.patch"><a href="/api/0/patches/{{build.source.patch.id}}/?raw=1" target="_self">{{build.source.patch.id}}</a></dd>
					<dt>Status:</dt>
					<dd>{{build.status.name}} <span ng-if="build.status.id == 'finished'">({{build.result.name}})</span></dd>
					<dt ng-if="build.dateStarted">Started:</dt>
					<dd ng-if="build.dateStarted" time-since="build.dateStarted"></dd>
					<dt ng-if="build.duration">Duration:</dt>
					<dd ng-if="build.duration" duration="build.duration"></dd>
				</dl>
			</div>
		</div>

		<pre ng-if="build.message" class="build-message" ng-bind-html="formattedBuildMessage"></pre>

		<h3>Jobs</h3>
		<table class="build-list table table-striped">
			<tbody>
				<tr class="status-{{job.status.id}} result-{{job.result.id}}"
					ng-repeat="job in jobs">
					<td>
						<div class="indicator" title="{{job.result.name}}">
							<div data-result="{{job.result.id}}"
								 data-status="{{job.status.id}}"
								 data-date-started="{{job.dateStarted}}"
								 data-estimated-duration="{{job.estimatedDuration}}"
								 radial-progress-bar>&nbsp;</div>
						</div>
					</td>
					<td>
						<a href="{{job.link}}">{{job.name}}</a><br>

						<small>
							<span ng-if="build.number">#{{build.number}}.{{job.number}} &mdash; </span>
							{{job.target}}
						</small>
						<span class="status">{{getBuildStatus(job)}}</span>
						<span class="date" ng-if="job.dateStarted" time-since="job.dateStarted"></span>
					</td>
				</tr>
			</tbody>
		</table>

		<div ng-if="testFailures.total">
			<div class="page-header">
				<h3>Test Failures <small>{{ testFailures.total }} total</small></h3>
			</div>

			<table class="table table-striped table-bordered">
				<thead>
					<tr>
						<th colspan="2">&nbsp;</th>
						<th style="width:110px;text-align:center">Duration</th>
					</tr>
				</thead>
				<tbody>
					<tr ng-repeat="testGroup in testFailures.testGroups" class="result-{{testGroup.result.id}}">
						<td class="result"><span></span></td>
						<td>
							<a href="{{ testGroup.link }}">{{ testGroup.name }}</a><br>
							<small>
								<span ng-if="testGroup.job.number">#{{build.number}}.{{testGroup.job.number}} &mdash;</span>
								<span ng-if="testGroup.origin">
									This failure originated in <span ng-if="testGroup.origin.id == job.id">this job</span><span ng-if="testGroup.origin.id != job.id"><a href="{{ testGroup.origin.link }}">{{ testGroup.origin.target }}</a><span ng-if="testGroup.origin.author"> &mdash; {{ testGroup.origin.author.name }}</span></span>
								</span>
							</small>
						</td>
						<td style="text-align:center" duration="testGroup.duration"></td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>
</section>
